CREATE TABLE IF NOT EXISTS public.users
(
    id int generated by default as identity primary key,
    full_name varchar(100) not null,
    login varchar (50),
    password varchar(20)
);

CREATE TABLE IF NOT EXISTS public.roles
(
    id bigint generated by default as identity primary key,
    role varchar(20) not null,
    comment text
);

CREATE TABLE IF NOT EXISTS public.users_have_roles
(
    user_id int REFERENCES public.users (id),
    role_id int REFERENCES public.roles (id)
);

CREATE TABLE IF NOT EXISTS public.file
(
    id int generated by default as identity primary key,
    file_name varchar(50)
);

CREATE TABLE IF NOT EXISTS public.storage
(
    id int generated by default as identity primary key
);

CREATE TABLE IF NOT EXISTS public.storage_has_files
(
    storage_id int REFERENCES public.storage (id) ON DELETE CASCADE,
    file_id int REFERENCES public.file (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS public.partners
(
    id int generated by default as identity primary key,
    partner varchar(50) not null,
    comment text
);

CREATE TABLE IF NOT EXISTS public.partners_list
(
    id int generated by default as identity primary key
);

CREATE TABLE IF NOT EXISTS public.partners_list_has_partners
(
    list_id int REFERENCES public.partners_list (id) ON DELETE CASCADE,
    partner_id int REFERENCES public.partners (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS public.conference
(
    id int generated by default as identity primary key,
    theme varchar(100) not null,
    date timestamp WITH TIME ZONE not null,
    organizer varchar(100) not null,
    link text,
    storage_id int REFERENCES public.storage (id) ON DELETE SET NULL,
    partner_list_id int REFERENCES public.partners_list (id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS public.conference_member
(
    id int generated by default as identity primary key,
    user_id int REFERENCES public.users (id),
    conference_id int REFERENCES public.conference (id),
    storage_id int REFERENCES public.storage (id)
);


=============DOWN================

DROP TABLE IF EXISTS public.conference_member CASCADE;
DROP TABLE IF EXISTS public.conference CASCADE;
DROP TABLE IF EXISTS public.partners_list_has_partners CASCADE;
DROP TABLE IF EXISTS public.partners_list CASCADE;
DROP TABLE IF EXISTS public.partners CASCADE;
DROP TABLE IF EXISTS public.storage_has_files CASCADE;
DROP TABLE IF EXISTS public.storage CASCADE;
DROP TABLE IF EXISTS public.file CASCADE;
DROP TABLE IF EXISTS public.users_have_roles CASCADE;
DROP TABLE IF EXISTS public.roles CASCADE;
DROP TABLE IF EXISTS public.users CASCADE;